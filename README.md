1. Установка

Клонирование репозитория выполняется
следующей командой:

git clone --recurse-submodules https://github.com/VitalikSokolov1920/deamon_timer.git

После клонирования необходимо зайти в к директорию libpqxx проекта и выполнить следующие команды:

1. ./configure CXXFLAGS="-std=c++17"

2. make

3. sudo make install

После этого утилита будет готова к запуску

2. Настройка

Для корректной работы утилиты необходимы следующие файлы:

1. Файл конфигурации, доступный для чтения

2. Bash-скрипт, настраивающий переменные окружения и выполняющий запуск утилиты

Пример файл конфигурации и bash-скрипта доступны в корне проекта

3. Описание файла конфигурации

Файл конфигурации состоит из команд, доступны два вида команд:

1. DUMP - выполняет резервное копироване базы данных

2. SQL - выполняет список SQL-запросов

Команда DUMP состоит из 3 частей:

1. Ключевое слово DUMP(регистр не важен)
2. Время начала выполнения команды
3. Период повтора выполнения команды

Команда SQL состоит из 4 частей:

1. Ключевое слово SQL(регистр не важен)
2. Время начала выполнения команды
3. Период повтора выполнения команды
4. Список SQL-запросов(список состоит из 1 или более запросов)

Важно: корректность SQL-запросов утилитой не проверяется, в случае ошибки в файл логирования будет записано описание ошибки

Формат времени задаётся в следующие виде: YYYY-MM-DD-hh-mm-ss,
где YYYY - год, MM-месяц, DD - день месяца,
hh - час, mm - минуты, ss - секунды.

Год ,месяц, день, час, минуты и секунды могут задаваться как 05, так и 5

При описании даты можно опустить некоторые части, к примеру только указать год, месяц, день, остальные компоненты даты будут равны нулю

Следующие даты корректны:

2023-1-12 - 12 января 2023 года

2023-1-12-18 - 6 часов вечера 12 января 2023 года

2023-1-12-18-36 6 часов вечера 36 минут 12 января 2023 года

Следующие даты для интервального времени корректны:

0-0-1 - период в 1 день

0-0-0-12 - период в 12 часов

0-0-0-0-30 - период в 30 минут

Если дата начала выполнения команды меньше, чем текущая дата, то команда выполнится сразу

Если дата периода выполнения равно 0-0-0-0-0-0, то команда выполнится один раз без дальнейших повторов

4. Описание BASH-скрипта для запуска

Скрипт должен включать следующие переменные окружения:

1. PGUSER - имя пользователя СУБД
2. PGPASSWORD - пароль пользователя
3. PGDBNAME - название базы данных
4. LOG_PATH - путь к файлу логирования(необязательный параметр, значение по умолчанию - ./ivt_log.log)
5. DUMP_PATH - путь к директории для дампов базы данных(необязательный параметр, значение по умолчанию - ./backup)

Так же скрипт должен выполнять запуск утилиты и передавать в качества аргумента командной строки путь к конфигурационному файлу

5. Логирование

При выполнении команды в файл для логирования записывается информация о команде

Для дампа базы данных будет указано в левом верхнем углу записи "DUMP DATABASE", 
так же будет указана стартовая дата начала, период выполнения и текущее время

Для выполнения SQL-запросов будет указано в верхнем левом углу SQL SCRIPT, 
так же будет указана стартовая дата начала, период выполнения, текущее время
и список SQL-запросов, которые были выполнены

В случае ошибки в лог-файл будет выведена информация об ошибке